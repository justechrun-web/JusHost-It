{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account within the JusHostIt platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name or full name."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile photo.",
          "format": "uri"
        },
        "isAdmin": {
          "type": "boolean",
          "description": "Indicates if the user has admin privileges."
        },
        "mfaEnabled": {
          "type": "boolean",
          "description": "Indicates if multi-factor authentication is enabled for the user."
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Site": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Site",
      "type": "object",
      "description": "Represents a website hosted on the JusHostIt platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the site entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Site)"
        },
        "domain": {
          "type": "string",
          "description": "Domain name of the website."
        },
        "plan": {
          "type": "string",
          "description": "Hosting plan selected for the website (e.g., Basic, Pro)."
        },
        "status": {
          "type": "string",
          "description": "Current status of the website (e.g., Active, Suspended, Provisioning)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the site was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "domain",
        "plan",
        "status"
      ]
    },
    "BillingSubscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "BillingSubscription",
      "type": "object",
      "description": "Represents a billing subscription for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the billing subscription."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 BillingSubscription)"
        },
        "stripeSubscriptionId": {
          "type": "string",
          "description": "Stripe Subscription ID for managing billing through Stripe."
        },
        "plan": {
          "type": "string",
          "description": "Name of plan subscribed to. (e.g. Basic, Pro)."
        },
        "status": {
          "type": "string",
          "description": "Status of the subscription. (e.g. Active, Canceled)"
        },
        "nextBillingDate": {
          "type": "string",
          "description": "The next date the customer will be billed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "stripeSubscriptionId",
        "plan",
        "status"
      ]
    },
    "SupportTicket": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SupportTicket",
      "type": "object",
      "description": "Represents a support ticket submitted by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the support ticket."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N SupportTicket)"
        },
        "subject": {
          "type": "string",
          "description": "Subject of the support ticket."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the issue."
        },
        "status": {
          "type": "string",
          "description": "Current status of the support ticket (e.g., Open, In Progress, Closed)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the ticket was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "subject",
        "description",
        "status"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Path-based ownership ensures that only the user can access their profile data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/sites/{siteId}",
        "definition": {
          "entityName": "Site",
          "schema": {
            "$ref": "#/backend/entities/Site"
          },
          "description": "Stores website information. Enforces ownership via path-based access and the 'userId' field within the document. This achieves Authorization Independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (site owner)."
            },
            {
              "name": "siteId",
              "description": "The unique identifier for the site."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/billingSubscriptions/{billingSubscriptionId}",
        "definition": {
          "entityName": "BillingSubscription",
          "schema": {
            "$ref": "#/backend/entities/BillingSubscription"
          },
          "description": "Stores billing subscription information. Enforces ownership via path-based access and the 'userId' field within the document. This achieves Authorization Independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (subscription owner)."
            },
            {
              "name": "billingSubscriptionId",
              "description": "The unique identifier for the billing subscription."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/supportTickets/{supportTicketId}",
        "definition": {
          "entityName": "SupportTicket",
          "schema": {
            "$ref": "#/backend/entities/SupportTicket"
          },
          "description": "Stores support ticket information. Enforces ownership via path-based access and the 'userId' field within the document. This achieves Authorization Independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (ticket submitter)."
            },
            {
              "name": "supportTicketId",
              "description": "The unique identifier for the support ticket."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores admin role information. Existence of a document implies the user has admin privileges. Uses existence over content.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure authorization independence, clarity, and scalability for the JusHostIt application. User data, site information, billing subscriptions, and support tickets are organized into collections, with clear ownership enforced through path-based access and denormalization where necessary. The structure supports the required QAPs (Rules are not Filters) by segregating data based on access requirements and utilizing path-based ownership for secure listing operations.\n\n1.  **Users Collection:** Stores user profiles. Path-based ownership ensures that only the user can access their own profile data.\n2.  **Sites Collection:** Stores website information. Each site document includes the `userId` field, enabling security rules to enforce that only the owner (user) of the site can read or modify it. The path `/users/{userId}/sites/{siteId}` enforces ownership and enables efficient listing of sites owned by a specific user. Also, this achieves Authorization Independence.\n3.  **BillingSubscriptions Collection:** Stores billing subscription information. Each subscription document includes the `userId` field, enabling security rules to enforce that only the owner (user) of the subscription can read or modify it. The path `/users/{userId}/billingSubscriptions/{billingSubscriptionId}` enforces ownership and enables efficient listing of subscriptions owned by a specific user. Also, this achieves Authorization Independence.\n4.  **SupportTickets Collection:** Stores support ticket information. Each ticket document includes the `userId` field, enabling security rules to enforce that only the owner (user) of the ticket can read or modify it. The path `/users/{userId}/supportTickets/{supportTicketId}` enforces ownership and enables efficient listing of tickets owned by a specific user. Also, this achieves Authorization Independence.\n5.  **RolesAdmin Collection:** Stores admin role information. This collection contains documents with the user's UID as the document ID. Existence of a document implies the user has admin privileges. This approach avoids custom claims, relying instead on database existence for authorization."
  }
}
