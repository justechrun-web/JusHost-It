{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account within the JusHostIt system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "Display name of the user."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile photo.",
          "format": "uri"
        },
        "emailVerified": {
          "type": "boolean",
          "description": "Indicates whether the user's email address has been verified."
        },
        "isAdmin": {
          "type": "boolean",
          "description": "Indicates whether the user has administrative privileges."
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Site": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Site",
      "type": "object",
      "description": "Represents a website hosted on JusHostIt.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Site entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Site)"
        },
        "domain": {
          "type": "string",
          "description": "Domain name of the website."
        },
        "plan": {
          "type": "string",
          "description": "Hosting plan associated with the website."
        },
        "status": {
          "type": "string",
          "description": "Current status of the website (e.g., active, suspended, provisioning)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the site was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "domain",
        "plan",
        "status"
      ]
    },
    "Billing": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Billing",
      "type": "object",
      "description": "Billing information for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Billing entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 Billing)"
        },
        "stripeCustomerId": {
          "type": "string",
          "description": "Stripe customer ID associated with the user."
        },
        "subscriptionStatus": {
          "type": "string",
          "description": "Status of the user's subscription (e.g., active, canceled)."
        },
        "currentPlan": {
          "type": "string",
          "description": "The current billing plan for the account."
        }
      },
      "required": [
        "id",
        "userId",
        "stripeCustomerId",
        "subscriptionStatus",
        "currentPlan"
      ]
    },
    "SupportTicket": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SupportTicket",
      "type": "object",
      "description": "Represents a support ticket opened by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SupportTicket entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N SupportTicket)"
        },
        "siteId": {
          "type": "string",
          "description": "Reference to Site. (Relationship: Site 1:N SupportTicket) Optional since tickets may not always be site-specific."
        },
        "subject": {
          "type": "string",
          "description": "Subject of the support ticket."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the issue."
        },
        "status": {
          "type": "string",
          "description": "Current status of the ticket (e.g., open, in progress, closed)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the ticket was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "subject",
        "description",
        "status"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user account information. Access is restricted to the authenticated user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/sites/{siteId}",
        "definition": {
          "entityName": "Site",
          "schema": {
            "$ref": "#/backend/entities/Site"
          },
          "description": "Stores website information for a given user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "siteId",
              "description": "The unique identifier of the site."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/billing/{billingId}",
        "definition": {
          "entityName": "Billing",
          "schema": {
            "$ref": "#/backend/entities/Billing"
          },
          "description": "Stores billing information for a given user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "billingId",
              "description": "The unique identifier of the billing record."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/supportTickets/{ticketId}",
        "definition": {
          "entityName": "SupportTicket",
          "schema": {
            "$ref": "#/backend/entities/SupportTicket"
          },
          "description": "Stores support tickets opened by a user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "ticketId",
              "description": "The unique identifier of the support ticket."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure authorization independence, clarity, and scalability for the JusHostIt application. User data, site information, billing details, and support tickets are organized into collections that allow for straightforward security rules based on the authenticated user's ID (request.auth.uid). \n\nAuthorization Independence: Each document that requires user-based authorization includes the 'userId' field. This denormalization prevents the need for complex `get()` calls in security rules to verify ownership, enabling atomic operations and improving rule simplicity and debuggability.\n\nQAPs Support:\n*   Private User Data: The `/users/{userId}` collection stores private user data. Access is restricted to the authenticated user via security rules, ensuring that users can only access their own data.\n*   User-Owned Data: Sites, Billing, and SupportTickets are structured as subcollections under the user. Each document stores the `userId` enabling list operations to securely display only the records associated with the authenticated user, eliminating the risk of unauthorized data exposure. The `userId` field within each subcollection document ensures QAPs compliance, enabling secure list operations.\n*   Admin Roles: While the application uses Firebase Authentication for user management, including the ability to set custom claims like 'admin', the Firestore structure does not directly rely on custom claims for its core authorization logic. Instead, the emphasis is placed on leveraging the authenticated user's ID (`request.auth.uid`) in conjunction with data stored within the Firestore documents themselves (specifically, the `userId` field) to enforce access control. This strategy aligns with the principles of Authorization Independence and simplifies security rules.\n\nData Clarity and Predictability: All collections use explicit and consistent naming conventions. Documents include a status field where applicable (e.g., Site, SupportTicket) to represent the entity's state clearly. This ensures consistency and simplifies querying and data management."
  }
}