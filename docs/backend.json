
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account within the JusHostIt platform.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the user (UID)." },
        "email": { "type": "string", "description": "Email address of the user.", "format": "email" },
        "displayName": { "type": "string", "description": "The user's display name or full name." },
        "photoURL": { "type": "string", "description": "URL of the user's profile photo.", "format": "uri" },
        "createdAt": { "type": "string", "format": "date-time" },
        "lastLogin": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "email"]
    },
    "Organization": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Organization",
      "type": "object",
      "description": "Represents an organization or company, which is the root for all resources like sites and members.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the organization." },
        "name": { "type": "string", "description": "Display name of the organization." },
        "ownerId": { "type": "string", "description": "The UID of the user who owns the organization." },
        "createdAt": { "type": "string", "format": "date-time" },
        "plan": { "type": "string", "description": "The organization's subscription plan (e.g., 'basic', 'pro')." },
        "stripeCustomerId": { "type": "string", "description": "The customer ID from Stripe for billing." },
        "subscriptionStatus": { "type": "string", "enum": ["trialing", "active", "past_due", "over_budget", "canceled", "incomplete"] },
        "monthlySpend": { "type": "number", "description": "Current spend for the month." },
        "hardCap": { "type": "boolean", "description": "Indicates if hard cap budget enforcement is enabled." }
      },
      "required": ["id", "name", "ownerId"]
    },
    "OrgMember": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrgMember",
      "type": "object",
      "description": "Represents a user's membership and role within an organization.",
      "properties": {
        "id": { "type": "string", "description": "Composite key: {userId}_{orgId}" },
        "userId": { "type": "string", "description": "Reference to User." },
        "orgId": { "type": "string", "description": "Reference to Organization." },
        "email": { "type": "string", "description": "Denormalized email of the user for easy lookup." },
        "role": { "type": "string", "enum": ["owner", "admin", "member", "viewer"] }
      },
      "required": ["id", "userId", "orgId", "email", "role"]
    },
    "OrgInvitation": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "OrgInvitation",
        "type": "object",
        "description": "Represents an invitation for a user to join an organization.",
        "properties": {
            "id": { "type": "string" },
            "orgId": { "type": "string" },
            "email": { "type": "string", "format": "email" },
            "role": { "type": "string", "enum": ["admin", "member", "viewer"] },
            "status": { "type": "string", "enum": ["pending", "accepted", "declined", "expired"] },
            "createdAt": { "type": "string", "format": "date-time" },
            "expiresAt": { "type": "string", "format": "date-time" }
        },
        "required": ["id", "orgId", "email", "role", "status"]
    },
    "Site": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Site",
      "type": "object",
      "description": "Represents a website hosted on the JusHostIt platform, owned by an organization.",
      "properties": {
        "id": { "type": "string" },
        "orgId": { "type": "string", "description": "Reference to Organization." },
        "domain": { "type": "string" },
        "status": { "type": "string", "enum": ["Active", "Suspended", "Provisioning"] },
        "createdAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "orgId", "domain", "status"]
    },
    "SupportTicket": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SupportTicket",
      "type": "object",
      "description": "Represents a support ticket submitted by a user.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "Reference to User." },
        "orgId": { "type": "string", "description": "Reference to Organization." },
        "subject": { "type": "string" },
        "description": { "type": "string" },
        "status": { "type": "string", "enum": ["Open", "In Progress", "Closed"] },
        "createdAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "userId", "orgId", "subject", "status"]
    }
  },
  "auth": {
    "providers": ["password", "google.com"]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": { "$ref": "#/entities/User" },
          "description": "Stores public user profile information. Writable only by the user themselves."
        }
      },
      {
        "path": "/orgs/{orgId}",
        "definition": {
          "entityName": "Organization",
          "schema": { "$ref": "#/entities/Organization" },
          "description": "Root document for an organization. Contains billing status, plan, and other metadata."
        }
      },
      {
        "path": "/orgMembers/{membershipId}",
        "definition": {
            "entityName": "OrgMember",
            "schema": { "$ref": "#/entities/OrgMember" },
            "description": "A flat collection for scalable role lookups. The ID is a composite key: {userId}_{orgId}. This enables security rules to quickly check a user's role within any organization."
        }
      },
      {
        "path": "/orgs/{orgId}/sites/{siteId}",
        "definition": {
          "entityName": "Site",
          "schema": { "$ref": "#/entities/Site" },
          "description": "Stores website information, nested under the owning organization."
        }
      },
      {
        "path": "/users/{userId}/supportTickets/{ticketId}",
        "definition": {
          "entityName": "SupportTicket",
          "schema": { "$ref": "#/entities/SupportTicket" },
          "description": "Stores support tickets submitted by a user."
        }
      },
      {
          "path": "/orgInvitations/{inviteId}",
          "definition": {
              "entityName": "OrgInvitation",
              "schema": { "$ref": "#/entities/OrgInvitation" },
              "description": "Stores pending invitations for users to join an organization. Documents can be cleaned up after they are accepted or expire."
          }
      }
    ],
    "reasoning": "This data model is designed for a multi-tenant SaaS application with role-based access control (RBAC). The key decision is the separation of Users from Organizations and the use of a flat `orgMembers` collection. A `User` is a global entity representing an authenticated identity. An `Organization` is the tenant that owns resources. The `orgMembers` collection acts as a mapping table, linking a `User` to an `Organization` with a specific `role`. This structure is highly scalable and allows security rules to efficiently check permissions without needing to query nested collections. For example, to check if a user is an admin of an org, a security rule can perform a single `get()` on `/orgMembers/{userId}_{orgId}`. Resources like `sites` are nested under `orgs` to enforce clear ownership and data locality."
  }
}
